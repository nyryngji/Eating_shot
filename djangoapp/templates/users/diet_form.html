{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/diet.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
{% endblock %}

{# !! TODO: image upload view  !! #}
<div class="main_container" id="main">
    <div class="deco">
        <img src="{% static 'img/back.png' %}" onclick="window.history.back()" class="back">
        <h2>식단 기록하기</h2>
        <p style="margin: 10px;">오늘의 식탁을 분석해드립니다!</p>
        <img src="{% static 'img/diet_form.png' %}" class="deco_chara">
    </div>
    
    <form method="post" enctype="multipart/form-data" action="">
        {% csrf_token %}
        <div class="meal_times" style="display: flex; justify-content: space-between;">
            <p>식사</p>
            
            <div class="check_meal_time">
                <div style="display: flex;" class="strength">
                    <input id="meal_time1" type="radio" name="meal_time"
                            value="breakfast" checked>
                    <label for="meal_time1" class="for_meal_time">아침</label>
                </div>

                <div style="display: flex;" class="strength">
                    <input id="meal_time2" type="radio" name="meal_time"
                            value="lunch">
                    <label for="meal_time2" class="for_meal_time">점심</label>
                </div>

                <div style="display: flex;" class="strength">
                    <input id="meal_time3" type="radio" name="meal_time"
                            value="dinner">
                    <label for="meal_time3" class="for_meal_time">저녁</label>
                </div>

                <div style="display: flex;" class="strength">
                    <input id="meal_time4" type="radio" name="meal_time"
                            value="snack">
                    <label for="meal_time4" class="for_meal_time">간식</label>
                </div>
            </div>
        </div>

        <input id="date_input" type="date" name="{{ form.date.name }}" value="{{ form.date.value }}">
        
        <div class="upload-box" onclick="document.getElementById('chooseFile').click();">
            <div id="drop-file" class="drag-file">
                <img src="{% static 'img/salad.png' %}" width="40px" height="40px" alt="">
                <label class="file-label" for="chooseFile" style="margin-top: 0;">식단 사진을 업로드해주세요.</label>
                <img src="" alt="미리보기 이미지" class="preview" id="image_preview">
            </div>
            <input class="file" id="chooseFile" type="file" name="{{ form.image.name }}" accept="image/*">
        </div>
        
        <input type="submit" value="기록하기"/>
    </form>
</div>
{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const dateInput = document.getElementById('date_input');
            dateInput.value = new Date().toISOString().split('T')[0];
        });

        document.getElementById('chooseFile').addEventListener('change', function (event) {
            const input = event.target;
            const label = document.querySelector('.file-label');
            const imgPreview = document.getElementById('image_preview');

            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    imgPreview.src = e.target.result;
                    imgPreview.style.display = 'block';
                    label.style.display = 'none';
                };

                reader.readAsDataURL(input.files[0]);
            }
        });
    </script>
{% endblock %}
