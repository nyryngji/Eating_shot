{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/diet.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
{% endblock %}

{# !! TODO: image upload view  !! #}
<div class="main_container" id="main">
    <div class="deco">
        <img src="{% static 'img/back.png' %}" onclick="window.history.back()" class="back">
        <h2>식단 수정하기</h2>
        <p>보다 자세한 결과를 위해!</p>
        <img src="{% static 'img/diet_form.png' %}" class="deco_chara">
    </div>
    
    <form method="post" enctype="multipart/form-data" action="">
        {% csrf_token %}
        {{ form.meal_type }}
        <input id="date_input" type="date" name="{{ form.date.name }}" value="{{ form.date.value }}">
        {#        {{ form.date.label_tag }} {{ form.date }}#}
        
        <div class="upload-box" onclick="document.getElementById('chooseFile').click();">
            <div id="drop-file" class="drag-file">
                <img src="{% static 'img/salad.png' %}" width="40px" height="40px" alt="">
                <label class="file-label" for="chooseFile" style="margin-top: 0;">식단 사진을 업로드해주세요.</label>
                <img src="" alt="미리보기 이미지" class="preview" id="image_preview">
            </div>
            <input class="file" id="chooseFile" type="file" name="{{ form.image.name }}" accept="image/*">
        </div>
        
        <input type="submit" value="수정하기"/>
    </form>
</div>
{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const dateInput = document.getElementById('date_input');
            dateInput.value = new Date().toISOString().split('T')[0];
        });

        document.getElementById('chooseFile').addEventListener('change', function (event) {
            const input = event.target;
            const label = document.querySelector('.file-label');
            const imgPreview = document.getElementById('image_preview');

            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    imgPreview.src = e.target.result;
                    imgPreview.style.display = 'block';
                    label.style.display = 'none';
                };

                reader.readAsDataURL(input.files[0]);
            }
        });
    </script>
{% endblock %}
